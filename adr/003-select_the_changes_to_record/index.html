
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Lyz">
      
      
        <link rel="canonical" href="https://lyz-code.github.io/mkdocs-newsletter/adr/003-select_the_changes_to_record/">
      
      
        <link rel="prev" href="../002-initial_plugin_design/">
      
      
        <link rel="next" href="../004-article_newsletter_structure/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.0-b3">
    
    
      
        <title>003: Select the changes to record - MkDocs Newsletter</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.83068744.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/links.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#status" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MkDocs Newsletter" class="md-header__button md-logo" aria-label="MkDocs Newsletter" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MkDocs Newsletter
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              003: Select the changes to record
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lyz-code/mkdocs-newsletter" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lyz-code/mkdocs-newsletter
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MkDocs Newsletter" class="md-nav__button md-logo" aria-label="MkDocs Newsletter" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MkDocs Newsletter
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lyz-code/mkdocs-newsletter" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lyz-code/mkdocs-newsletter
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MkDocs Newsletter
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Usage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../adr/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Architecture Decision Records
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_6">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Architecture Decision Records
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../001-initial_approach/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    001: High level problem analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../002-initial_plugin_design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    002: Initial mkdocs plugin design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    003: Select the changes to record
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    003: Select the changes to record
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposals" class="md-nav__link">
    Proposals
  </a>
  
    <nav class="md-nav" aria-label="Proposals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract-the-last-published-changes" class="md-nav__link">
    Extract the last published changes
  </a>
  
    <nav class="md-nav" aria-label="Extract the last published changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-meaningful-tags-to-the-repository" class="md-nav__link">
    Add meaningful tags to the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-the-last-commit-ids-in-a-file-in-the-repo" class="md-nav__link">
    Save the last commit ids in a file in the repo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-the-last-commit-ids-in-the-mkdocsyaml-file" class="md-nav__link">
    Save the last commit ids in the mkdocs.yaml file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deduce-the-last-published-date-from-existent-articles" class="md-nav__link">
    Deduce the last published date from existent articles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse-the-commit-messages" class="md-nav__link">
    Parse the commit messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-file-context-from-the-mkdocs-nav" class="md-nav__link">
    Extract file context from the MkDocs nav
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-changes-that-need-to-be-added-to-the-newsletter-articles" class="md-nav__link">
    Get the changes that need to be added to the newsletter articles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    Decision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    Consequences
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../004-article_newsletter_structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    004: Article newsletter structure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../005-create_the_newsletter_articles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    005: Article newsletter creation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../006-rss_feed_creation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    006: RSS feed creation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../00X-changelog_support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    00X: Changelog support
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposals" class="md-nav__link">
    Proposals
  </a>
  
    <nav class="md-nav" aria-label="Proposals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract-the-last-published-changes" class="md-nav__link">
    Extract the last published changes
  </a>
  
    <nav class="md-nav" aria-label="Extract the last published changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-meaningful-tags-to-the-repository" class="md-nav__link">
    Add meaningful tags to the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-the-last-commit-ids-in-a-file-in-the-repo" class="md-nav__link">
    Save the last commit ids in a file in the repo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#save-the-last-commit-ids-in-the-mkdocsyaml-file" class="md-nav__link">
    Save the last commit ids in the mkdocs.yaml file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deduce-the-last-published-date-from-existent-articles" class="md-nav__link">
    Deduce the last published date from existent articles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse-the-commit-messages" class="md-nav__link">
    Parse the commit messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-file-context-from-the-mkdocs-nav" class="md-nav__link">
    Extract file context from the MkDocs nav
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-changes-that-need-to-be-added-to-the-newsletter-articles" class="md-nav__link">
    Get the changes that need to be added to the newsletter articles
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    Decision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    Consequences
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>003: Select the changes to record</h1>

<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<!-- What is the status? Draft, Proposed, Accepted, Rejected, Deprecated or Superseded?
-->
<p>Accepted.</p>
<p>Based on: <a href="../002-initial_plugin_design/">002</a>,
<a href="../004-article_newsletter_structure/">004</a></p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<!-- What is the issue that we're seeing that is motivating this decision or change? -->
<p>We need to create some logic that reads from the git log to:</p>
<ul>
<li>
<p><a href="#extract-the-last-published-changes">Extract the last published changes</a>.  To
    update the articles and feeds, we need to know which changes have been
    already published, so subsequent mkdocs build processes don't repeat work
    already done.</p>
</li>
<li>
<p><a href="#parse-the-commit-messages">Parse the commit messages</a> to extract the
    semantic versioning information from them.</p>
<p>The message must follow the <a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#commits">angular commit
guidelines</a>
with the exception that we'll allow many changes in the same commit message.</p>
</li>
<li>
<p><a href="#extract-the-file-context-from-the-mkdocs-nav">Extract file context from the MkDocs nav</a></p>
</li>
<li><a href="#get-the-commits-that-need-to-be-added-to-the-newsletter-articles">Get the changes that need to be added to the newsletter
    articles</a>.
    We've defined different levels of aggregation for the user to choose how
    often they want to be notified: daily, weekly, monthly or yearly.</li>
</ul>
<h2 id="proposals">Proposals<a class="headerlink" href="#proposals" title="Permanent link">&para;</a></h2>
<!-- What are the possible solutions to the problem described in the context -->

<h3 id="extract-the-last-published-changes">Extract the last published changes<a class="headerlink" href="#extract-the-last-published-changes" title="Permanent link">&para;</a></h3>
<p>We can:</p>
<ul>
<li><em>Add meaningful tags to the repository</em>: If we create a tag <code>last_weekly</code> on the
    commit of the last published changed for the weekly feed, then we can
    add to the changes to publish only those posterior to that commit.</li>
<li><em>Save the last commit ids in a file in the repo</em>: If we create a hidden
    <code>.last_published.json</code> with the last commit id of each feed type,
    we can add to the feeds only the changes that are posterior to those
    commits.</li>
<li><em>Save the last commit ids in the mkdocs.yaml file</em>: We can save the last
    commit ids in the configuration section of the plugin in the mkdocs.yaml
    file.</li>
<li><em>Deduce the last published date from existent articles</em>: We already have this
    information in the existent articles. All we would need to do is analyze the
    files in the <code>on_files</code> and deduce the last content publication.</li>
</ul>
<h4 id="add-meaningful-tags-to-the-repository">Add meaningful tags to the repository<a class="headerlink" href="#add-meaningful-tags-to-the-repository" title="Permanent link">&para;</a></h4>
<p>Using tags has the advantage that we could reuse the <code>Repo</code> object to extract
the information, which we already use in the services that process the changes.
The disadvantage is that we'll pollute the git repository with tags that may not
be interesting to the user. In the digital garden case, it's not a problem, but
it can be in the changelog one.</p>
<h4 id="save-the-last-commit-ids-in-a-file-in-the-repo">Save the last commit ids in a file in the repo<a class="headerlink" href="#save-the-last-commit-ids-in-a-file-in-the-repo" title="Permanent link">&para;</a></h4>
<p>Storing the commit ids in a hidden json file has the advantage that we don't
pollute the git repository, we can use the
<a href="https://pydantic-docs.helpmanual.io/usage/exporting_models/#modeljson"><code>json</code></a>
export and import functionality of pydantic. The disadvantage is that we'll
create an additional file in the repository.
<a href="https://cruft.github.io/cruft/">cruft</a> uses this method.</p>
<h4 id="save-the-last-commit-ids-in-the-mkdocsyaml-file">Save the last commit ids in the mkdocs.yaml file<a class="headerlink" href="#save-the-last-commit-ids-in-the-mkdocsyaml-file" title="Permanent link">&para;</a></h4>
<p>Storing the commit ids in the mkdocs.yaml file has the advantage that it doesn't
pollute either the git repository nor the project directory. The disadvantage is
that it pollutes the mkdocs configuration file.</p>
<h4 id="deduce-the-last-published-date-from-existent-articles">Deduce the last published date from existent articles<a class="headerlink" href="#deduce-the-last-published-date-from-existent-articles" title="Permanent link">&para;</a></h4>
<p>Using the existent articles has these advantages:</p>
<ul>
<li>It doesn't pollute either the git repository, nor the project directory nor
    the mkdocs configuration file.</li>
<li>We can fetch the last published date per feed before parsing the commits, so
    instead of analyzing the whole history, we can go from the newest till the
    desired dates, making the algorithm more efficient..</li>
<li>We don't overwrite the existent articles, so if the user makes changes on
    them, they are respected.</li>
</ul>
<p>The disadvantage is that we need to code the extraction of that dates from the
files collection, but it should not be difficult.</p>
<p>Assuming that we have the existent articles organized following
<a href="../004-article_newsletter_structure/#how-to-organize-the-articles-in-the-mkdocs-nav-and-in-the-repository">004</a>,
we can create a function that reads the <code>files</code> attribute from the <code>on_files</code>
event and deduces the date of the last change of the last newsletter article for
each feed.</p>
<h3 id="parse-the-commit-messages">Parse the commit messages<a class="headerlink" href="#parse-the-commit-messages" title="Permanent link">&para;</a></h3>
<p>We can:</p>
<ul>
<li>Use the
    <a href="https://python-semantic-release.readthedocs.io/">python-semantic-release</a>
    library.</li>
<li>Use the <a href="https://github.com/commitizen-tools/commitizen">commitizen</a> library.</li>
<li>Write our own parser.</li>
</ul>
<p>After reviewing the existent libraries, I've found that python-semantic-release
exposes the parsed data in a friendlier way. The only drawback is that it uses
NamedTuples for the objects that hold the parsed data, so if we want to change
one, we need to create a new one from the old.</p>
<p>Using an existent library, if it's well maintained, is always better than
writing your own.</p>
<h3 id="extract-file-context-from-the-mkdocs-nav">Extract file context from the MkDocs nav<a class="headerlink" href="#extract-file-context-from-the-mkdocs-nav" title="Permanent link">&para;</a></h3>
<p>For each file that contains changes, we need to deduce the relative position in
the nav against the rest of articles. This is necessary so we're able to group
changes together by category, subcategory and file later in the <a href="../005-create_the_newsletter_articles/">newsletter
creation</a>.</p>
<p>We can use the
<a href="https://lyz-code.github.io/blue-book/coding/python/deepdiff/">Deepdiff</a> to
locate the file in the nav tree, and then extract the context information from
the path.</p>
<h3 id="get-the-changes-that-need-to-be-added-to-the-newsletter-articles">Get the changes that need to be added to the newsletter articles<a class="headerlink" href="#get-the-changes-that-need-to-be-added-to-the-newsletter-articles" title="Permanent link">&para;</a></h3>
<p>For a change to be added to each feed it needs to:</p>
<ul>
<li>year: Be made before the first day of the year and after the last published
    change in the year feed.</li>
<li>month: Be made before the first day of the month and after the last published
    change in the month feed.</li>
<li>week: Be made before the last Monday and after the last published change in
    the week feed.</li>
<li>day: Be made before today and after the last published change in the day
    feed.</li>
</ul>
<h2 id="decision">Decision<a class="headerlink" href="#decision" title="Permanent link">&para;</a></h2>
<!-- What is the change that we're proposing and/or doing? -->
<p>We will:</p>
<ul>
<li>Run this phase in the
    <a href="https://www.mkdocs.org/user-guide/plugins/#on_files"><code>on_files</code></a> MkDocs
    event to be able to have the list of articles to process.</li>
<li><a href="#deduce-the-last-published-date-from-existent-articles">Deduce the last published date from existent
    articles</a> as it's
    the cleanest solution in terms of repository pollution.</li>
<li>Extract the last published dates <em>before</em> we parse the commit messages.</li>
<li>Process only the commits that are posterior to those dates.</li>
<li>Use python-semantic-release library to parse the commit messages.</li>
<li>Extract file context from the MkDocs nav</li>
<li>Get the changes that need to be added to the newsletter articles with the
    different feeds.</li>
</ul>
<h2 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h2>
<!-- What becomes easier or more difficult to do because of this change? -->
<p>We don't have to write the parsing logic, it's maintained by the community and
it needs few changes to fulfill our needs.</p>
<p>Advantages:</p>
<ul>
<li>We'll know between builds which changes have been already published.</li>
<li>We'll reduce the amount of commits that we parse, thus making the process more
    efficient.</li>
<li>We wont overwrite manual user changes in the published articles.</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>We need to code and maintain the extraction of last published date from the
    list of repository files.</li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2021-03-18T13:48:57+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2021-03-18</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../002-initial_plugin_design/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 002: Initial mkdocs plugin design" rel="prev">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                002: Initial mkdocs plugin design
              </div>
            </div>
          </a>
        
        
          
          <a href="../004-article_newsletter_structure/" class="md-footer__link md-footer__link--next" aria-label="Next: 004: Article newsletter structure" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                004: Article newsletter structure
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.footer", "navigation.top", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.4e31edb1.min.js"></script>
      
        
          <script src="../../js/timeago.min.js"></script>
        
      
        
          <script src="../../js/timeago_mkdocs_material.js"></script>
        
      
    
  </body>
</html>